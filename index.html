<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Farewell to the One I So Loved</title>
    <meta name="description" content="A cosmic farewell letter with memories, music, and eternal love">
    <style>
        :root {
            --bg-1: #000428;
            --bg-2: #004e92;
            --accent-1: #b794f6;
            --accent-2: #9f7aea;
            --text: #f0e6ff;
            --muted: rgba(255, 255, 255, 0.75);
            --glass: rgba(255, 255, 255, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: 'Georgia', serif;
            color: var(--text);
            background: linear-gradient(180deg, var(--bg-1) 0%, var(--bg-2) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Canvas Layers */
        #starCanvas, #reactiveCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        #starCanvas { z-index: 1; }
        #reactiveCanvas { z-index: 2; mix-blend-mode: screen; }

        /* Nebula Effects */
        .nebula {
            position: fixed;
            width: 500px;
            height: 500px;
            border-radius: 50%;
            filter: blur(60px);
            opacity: 0.3;
            pointer-events: none;
            animation: float-nebula 30s ease-in-out infinite;
        }

        .nebula.one {
            background: radial-gradient(circle at 30% 30%, rgba(183, 148, 246, 0.3), transparent 70%);
            top: -200px;
            left: -200px;
        }

        .nebula.two {
            background: radial-gradient(circle at 70% 70%, rgba(159, 122, 234, 0.3), transparent 70%);
            bottom: -200px;
            right: -200px;
            animation-delay: 15s;
        }

        @keyframes float-nebula {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(50px, -50px) scale(1.1); }
            66% { transform: translate(-30px, 30px) scale(0.9); }
        }

        /* Entry Overlay */
        .entry-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(ellipse at center, #1b2735 0%, #090a0f 100%);
            transition: opacity 1s cubic-bezier(0.4, 0, 0.2, 1), transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(5px);
        }

        .entry-overlay.hidden {
            opacity: 0;
            transform: scale(1.05);
            pointer-events: none;
        }

        .entry-card {
            text-align: center;
            padding: 40px;
            max-width: 600px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            animation: entry-float 4s ease-in-out infinite;
        }

        @keyframes entry-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        .entry-title {
            font-size: 2.5em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #fff, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 30px rgba(183, 148, 246, 0.5));
            animation: pulse-title 3s ease-in-out infinite;
        }

        @keyframes pulse-title {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .entry-subtitle {
            color: var(--muted);
            font-style: italic;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .enter-button {
            padding: 15px 40px;
            font-size: 1.1em;
            background: linear-gradient(135deg, rgba(183, 148, 246, 0.1), rgba(159, 122, 234, 0.1));
            border: 2px solid rgba(183, 148, 246, 0.3);
            color: #fff;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .enter-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(183, 148, 246, 0.4), transparent);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .enter-button:hover::before {
            width: 300px;
            height: 300px;
        }

        .enter-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(183, 148, 246, 0.3);
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 10;
            max-width: 900px;
            margin: 0 auto;
            padding: 60px 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h1 {
            font-size: clamp(1.8em, 4vw, 2.5em);
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(45deg, #fff, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 30px rgba(159, 122, 234, 0.3));
            animation: glow-text 3s ease-in-out infinite;
        }

        @keyframes glow-text {
            0%, 100% { filter: drop-shadow(0 0 30px rgba(159, 122, 234, 0.3)); }
            50% { filter: drop-shadow(0 0 50px rgba(159, 122, 234, 0.5)); }
        }

        /* Audio Container */
        .audio-container {
            max-width: 500px;
            margin: 30px auto;
            padding: 20px;
            background: var(--glass);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .audio-label {
            text-align: center;
            color: var(--accent-1);
            font-style: italic;
            margin-bottom: 15px;
        }

        #audioVisualizer {
            width: 100%;
            height: 60px;
            border-radius: 10px;
            margin: 10px 0;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
        }

        .audio-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .audio-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        /* 3D Memory Cards */
        .memories {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 50px 0;
            flex-wrap: wrap;
            perspective: 1000px;
        }

        .memory-card {
            width: 260px;
            height: 180px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .memory-card:hover {
            transform: rotateY(5deg) rotateX(-5deg) scale(1.05);
        }

        .memory-face {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            overflow: hidden;
            backface-visibility: hidden;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .memory-face img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .memory-glow {
            position: absolute;
            inset: -20px;
            background: radial-gradient(circle, rgba(183, 148, 246, 0.3), transparent 70%);
            filter: blur(20px);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .memory-card:hover .memory-glow {
            opacity: 1;
        }

        /* Letter */
        .letter {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(255, 255, 255, 0.01));
            border-radius: 20px;
            padding: 40px;
            margin: 40px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .letter::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(183, 148, 246, 0.05), transparent 70%);
            animation: rotate-gradient 30s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate-gradient {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .letter p {
            line-height: 1.9;
            margin-bottom: 25px;
            font-size: 1.1em;
            color: var(--text);
            position: relative;
            z-index: 1;
            opacity: 0;
            transform: translateY(20px);
            animation: fade-up 0.8s forwards;
        }

        @keyframes fade-up {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .letter p:nth-child(1) { animation-delay: 0.2s; }
        .letter p:nth-child(2) { animation-delay: 0.4s; }
        .letter p:nth-child(3) { animation-delay: 0.6s; }
        .letter p:nth-child(4) { animation-delay: 0.8s; }
        .letter p:nth-child(5) { animation-delay: 1s; }
        .letter p:nth-child(6) { animation-delay: 1.2s; }
        .letter p:nth-child(7) { animation-delay: 1.4s; }
        .letter p:nth-child(8) { animation-delay: 1.6s; }

        h2 {
            text-align: center;
            font-size: 1.8em;
            margin: 50px 0 30px;
            color: #e9d8fd;
            font-style: italic;
            letter-spacing: 2px;
        }

        /* Thank You */
        .thank-you {
            text-align: center;
            font-size: 1.6em;
            margin: 60px 0;
            font-weight: bold;
            background: linear-gradient(90deg, #ffd89b, #19547b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s ease-in-out infinite;
            position: relative;
        }

        @keyframes shimmer {
            0%, 100% { 
                filter: brightness(1);
                transform: scale(1);
            }
            50% { 
                filter: brightness(1.3);
                transform: scale(1.02);
            }
        }

        /* Constellation SVG */
        .constellation {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.5;
        }

        /* Name Finale */
        #nameFinale {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5em;
            font-weight: bold;
            letter-spacing: 20px;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
            background: linear-gradient(45deg, #fff, var(--accent-1), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 50px rgba(183, 148, 246, 0.8));
        }

        .show-finale {
            animation: finale-reveal 5s ease-in-out forwards;
        }

        @keyframes finale-reveal {
            0% { 
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
                letter-spacing: 50px;
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
                letter-spacing: 20px;
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(3);
                letter-spacing: 100px;
                filter: drop-shadow(0 0 100px rgba(183, 148, 246, 1));
            }
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .entry-title { font-size: 1.8em; }
            .memory-card { width: 200px; height: 140px; }
            .letter { padding: 25px; }
            h1 { font-size: 1.5em; }
        }

        /* Print Styles */
        @media print {
            body { background: white; color: black; }
            .entry-overlay, canvas, .nebula, .constellation, .audio-container { display: none; }
            .letter { box-shadow: none; border: 1px solid #ddd; }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Canvas Layers -->
    <canvas id="starCanvas"></canvas>
    <canvas id="reactiveCanvas"></canvas>
    
    <!-- Nebula Effects -->
    <div class="nebula one"></div>
    <div class="nebula two"></div>
    
    <!-- Constellation SVG -->
    <svg class="constellation">
        <defs>
            <filter id="glow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                    <feMergeNode in="coloredBlur"/>
                    <feMergeNode in="SourceGraphic"/>
                </feMerge>
            </filter>
        </defs>
        <g filter="url(#glow)">
            <line x1="10%" y1="20%" x2="25%" y2="35%" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
            <line x1="25%" y1="35%" x2="40%" y2="25%" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
            <line x1="70%" y1="60%" x2="85%" y2="70%" stroke="rgba(255,255,255,0.1)" stroke-width="1"/>
            <circle cx="25%" cy="35%" r="2" fill="rgba(255,255,255,0.3)"/>
            <circle cx="85%" cy="70%" r="2" fill="rgba(255,255,255,0.3)"/>
        </g>
    </svg>

    <!-- Entry Overlay -->
    <div class="entry-overlay" id="entryOverlay" role="dialog" aria-modal="true">
        <div class="entry-card">
            <h2 class="entry-title">A Journey Through the Stars</h2>
            <p class="entry-subtitle">One last dance among the cosmos</p>
            <button class="enter-button" id="enterBtn" aria-label="Enter and play music">Enter & Listen</button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container" id="mainContainer" role="main">
        <h1>A Farewell to the One I So Loved and Will Love Until the Very End</h1>
        
        <!-- Audio Section -->
        <section class="audio-container" aria-label="Background music">
            <div class="audio-label">♪ Pisces - Tony Ann (A Piano Cover played live by me to you) ♪</div>
            <canvas id="audioVisualizer"></canvas>
            <audio id="bgMusic" loop preload="auto">
                <source src="Pisces - Tony Ann (Piano Cover).mp3" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
            <div class="audio-controls">
                <button class="audio-btn" id="playPauseBtn">Play</button>
                <button class="audio-btn" id="muteBtn">Mute</button>
                <input type="range" id="volumeSlider" min="0" max="100" value="70" style="width: 150px;">
            </div>
        </section>

        <!-- 3D Memory Cards -->
        <section class="memories" aria-label="Our memories">
            <div class="memory-card" data-tilt>
                <div class="memory-glow"></div>
                <div class="memory-face">
                    <img src="Screenshot 2025-02-22 223927.png" alt="A cherished memory of us">
                </div>
            </div>
            <div class="memory-card" data-tilt>
                <div class="memory-glow"></div>
                <div class="memory-face">
                    <img src="Screenshot 2025-02-15 134126.png" alt="Another precious moment together">
                </div>
            </div>
        </section>

        <h2>To the One I Have So Loved Before</h2>

        <article class="letter">
            <p>Maria, from the day I met you, I always knew there was something different about you — a luminescence that transformed my digital world into something cosmic and infinite. In the vast universe of souls, yours shone with a unique brilliance, drawing me in like gravity pulls wandering planets into orbit. You were my supernova in the darkness, radiating beauty you couldn't always see in yourself, like a star unaware of its own light reaching distant galaxies.</p>

            <p>How I would embrace you through pixels and words, wrapping you in virtual warmth that transcended screens, holding you close in our shared digital realm. Your beauty wasn't just in what could be seen, but in the depths — the way your messages held galaxies of emotion, your laughter echoing through our chats like cosmic music. I saw it all, even when shadows of self-doubt clouded your view, and I wanted nothing more than to be the mirror that reflected your true radiance back to you.</p>

            <p>Every memory we created sparkles like its own constellation in my heart — those endless Roblox adventures where we built entire worlds together, crafting kingdoms from blocks and laughter, exploring digital realms as if we were astronauts discovering new planets. Each late-night gameplay session was our own private universe, where "I love you" echoed through chat messages like signals traveling through space, never losing their meaning despite the distance.</p>

            <p>I cherish your kindness that flowed like solar winds carrying warmth across the void, your care that anchored me like gravity, and everything that made you uniquely <em>you</em>. The way you'd share your passion for makeup artistry, blending colors like an artist painting nebulae across the cosmos. Your love for mango Pepsi — that fizzy sweetness you described with such infectious joy it made me smile through the screen. Even the simple pleasure of tortillas became magical when filtered through your words, turning ordinary moments into stardust memories.</p>

            <p>Each day, I would write to you, pouring out verses about what you loved, what sparked your happiness like meteor showers across the night sky, and what dimmed your light, always trying to be your North Star in moments of darkness. My words were my way of holding you, of being present in your world even when pixels were all that connected us.</p>

            <p>Yet, as workloads piled like accumulating asteroids, they slowly drifted us apart, pulling us from those late-night gameplays and whispered "I love you"s that once filled our universe. The extensive demands of life became like dark matter — invisible yet powerful — transforming our constant connection into fleeting glimpses, like comets passing too far apart in their eternal dance. I regret it deeply, this gravitational pull of obligations that widened the distance between our hearts.</p>

            <p>Still, my love for you burns undimmed, an eternal flame in the heart of a dying star, wondering if our paths were meant to align forever or to teach us the beauty of fleeting orbits. You deserve a love as vast and unwavering as the universe itself — one that doesn't leave you waiting in the silence of space, one that honors your radiance, your spirit, your happiness. Though it aches like a black hole's pull, I release you now, not because my feelings have faded — they haven't, for I am still deeply in love — but because I fear I've become an anchor in your stellar journey when you were meant to soar freely through galaxies of joy.</p>

            <p>I value everything — every shared moment in our digital constellation, every message that bridged the space between us, every laugh that defied the silence of the void. Even though we may depart now, your happiness and mental health will always be my wish. For as our love compared to that souls that can dance together across any distance, I will never forget your impact.</p>
        </article>

        <div class="thank-you" id="thankYou">Thank you, Dior, for everything.</div>
    </main>

    <!-- Name Finale -->
    <div id="nameFinale">MARIA</div>

    <script>
        // ===== STAR CANVAS SYSTEM =====
        const starCanvas = document.getElementById('starCanvas');
        const starCtx = starCanvas.getContext('2d');
        const reactiveCanvas = document.getElementById('reactiveCanvas');
        const reactiveCtx = reactiveCanvas.getContext('2d');
        
        let stars = [];
        let shootingStars = [];
        let mouseX = 0.5;
        let mouseY = 0.5;
        let audioData = null;
        let analyser = null;

        function resizeCanvas() {
            starCanvas.width = reactiveCanvas.width = window.innerWidth;
            starCanvas.height = reactiveCanvas.height = window.innerHeight;
            initStars();
        }

        function initStars() {
            stars = [];
            const starCount = Math.min(200, Math.floor((window.innerWidth * window.innerHeight) / 5000));
            for (let i = 0; i < starCount; i++) {
                stars.push({
                    x: Math.random() * starCanvas.width,
                    y: Math.random() * starCanvas.height,
                    size: Math.random() * 2,
                    brightness: Math.random(),
                    twinkleSpeed: Math.random() * 0.005 + 0.001,
                    parallaxSpeed: Math.random() * 0.5 + 0.5
                });
            }
        }

        function createShootingStar() {
            if (Math.random() < 0.02 && shootingStars.length < 3) {
                shootingStars.push({
                    x: Math.random() * starCanvas.width,
                    y: Math.random() * starCanvas.height * 0.5,
                    length: Math.random() * 200 + 100,
                    speed: Math.random() * 10 + 5,
                    angle: Math.PI * 0.25 + Math.random() * Math.PI * 0.25,
                    opacity: 1,
                    life: 0
                });
            }
        }

        function drawStars() {
            starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
            
            // Draw regular stars
            stars.forEach(star => {
                // Parallax effect
                const parallaxX = (mouseX - 0.5) * star.parallaxSpeed * 50;
                const parallaxY = (mouseY - 0.5) * star.parallaxSpeed * 50;
                
                // Twinkle effect
                star.brightness += star.twinkleSpeed;
                const brightness = Math.sin(star.brightness) * 0.5 + 0.5;
                
                starCtx.beginPath();
                starCtx.arc(
                    star.x + parallaxX, 
                    star.y + parallaxY, 
                    star.size, 
                    0, 
                    Math.PI * 2
                );
                starCtx.fillStyle = `rgba(255, 255, 255, ${brightness})`;
                starCtx.fill();
                
                // Add glow effect for brighter stars
                if (star.size > 1.5) {
                    starCtx.beginPath();
                    starCtx.arc(
                        star.x + parallaxX, 
                        star.y + parallaxY, 
                        star.size * 3, 
                        0, 
                        Math.PI * 2
                    );
                    starCtx.fillStyle = `rgba(183, 148, 246, ${brightness * 0.1})`;
                    starCtx.fill();
                }
            });
            
            // Draw shooting stars
            shootingStars = shootingStars.filter(shootingStar => {
                shootingStar.x += Math.cos(shootingStar.angle) * shootingStar.speed;
                shootingStar.y += Math.sin(shootingStar.angle) * shootingStar.speed;
                shootingStar.life++;
                shootingStar.opacity = Math.max(0, 1 - shootingStar.life / 50);
                
                const gradient = starCtx.createLinearGradient(
                    shootingStar.x, shootingStar.y,
                    shootingStar.x - Math.cos(shootingStar.angle) * shootingStar.length,
                    shootingStar.y - Math.sin(shootingStar.angle) * shootingStar.length
                );
                gradient.addColorStop(0, `rgba(255, 255, 255, ${shootingStar.opacity})`);
                gradient.addColorStop(0.5, `rgba(183, 148, 246, ${shootingStar.opacity * 0.5})`);
                gradient.addColorStop(1, 'transparent');
                
                starCtx.strokeStyle = gradient;
                starCtx.lineWidth = 2;
                starCtx.beginPath();
                starCtx.moveTo(shootingStar.x, shootingStar.y);
                starCtx.lineTo(
                    shootingStar.x - Math.cos(shootingStar.angle) * shootingStar.length,
                    shootingStar.y - Math.sin(shootingStar.angle) * shootingStar.length
                );
                starCtx.stroke();
                
                return shootingStar.opacity > 0;
            });
            
            createShootingStar();
        }

        // ===== AUDIO VISUALIZER =====
        function setupAudioVisualizer() {
            const audio = document.getElementById('bgMusic');
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaElementSource(audio);
            
            source.connect(analyser);
            analyser.connect(audioContext.destination);
            analyser.fftSize = 128;
            
            audioData = new Uint8Array(analyser.frequencyBinCount);
            
            const vizCanvas = document.getElementById('audioVisualizer');
            const vizCtx = vizCanvas.getContext('2d');
            vizCanvas.width = vizCanvas.offsetWidth;
            vizCanvas.height = vizCanvas.offsetHeight;
            
            function drawVisualizer() {
                if (!audio.paused) {
                    analyser.getByteFrequencyData(audioData);
                    
                    vizCtx.clearRect(0, 0, vizCanvas.width, vizCanvas.height);
                    
                    const barWidth = vizCanvas.width / audioData.length;
                    const gradient = vizCtx.createLinearGradient(0, 0, 0, vizCanvas.height);
                    gradient.addColorStop(0, '#b794f6');
                    gradient.addColorStop(1, '#9f7aea');
                    
                    audioData.forEach((value, index) => {
                        const barHeight = (value / 255) * vizCanvas.height * 0.8;
                        const x = index * barWidth;
                        
                        vizCtx.fillStyle = gradient;
                        vizCtx.fillRect(x, vizCanvas.height - barHeight, barWidth - 1, barHeight);
                    });
                    
                    // Audio-reactive effects on page
                    const average = audioData.reduce((a, b) => a + b) / audioData.length;
                    const intensity = average / 255;
                    
                    // Make letter pulse
                    const letter = document.querySelector('.letter');
                    if (letter) {
                        letter.style.boxShadow = `0 0 ${20 + intensity * 30}px rgba(183, 148, 246, ${0.2 + intensity * 0.3})`;
                    }
                    
                    // Make stars react
                    reactiveCtx.clearRect(0, 0, reactiveCanvas.width, reactiveCanvas.height);
                    if (intensity > 0.3) {
                        reactiveCtx.fillStyle = `rgba(183, 148, 246, ${intensity * 0.1})`;
                        reactiveCtx.fillRect(0, 0, reactiveCanvas.width, reactiveCanvas.height);
                    }
                }
                
                requestAnimationFrame(drawVisualizer);
            }
            
            drawVisualizer();
        }

        // ===== 3D MEMORY CARDS =====
        function setup3DCards() {
            const cards = document.querySelectorAll('.memory-card');
            
            cards.forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = (e.clientX - rect.left) / rect.width;
                    const y = (e.clientY - rect.top) / rect.height;
                    
                    const rotateY = (x - 0.5) * 20;
                    const rotateX = (y - 0.5) * -20;
                    
                    card.style.transform = `rotateY(${rotateY}deg) rotateX(${rotateX}deg) scale(1.05)`;
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'rotateY(0) rotateX(0) scale(1)';
                });
            });
        }

        // ===== ENTRY & INITIALIZATION =====
        window.addEventListener('load', () => {
            resizeCanvas();
            setup3DCards();
            
            // Create entry stars
            const entryOverlay = document.getElementById('entryOverlay');
            for (let i = 0; i < 30; i++) {
                const star = document.createElement('div');
                star.style.position = 'absolute';
                star.style.width = star.style.height = Math.random() * 3 + 'px';
                star.style.background = 'white';
                star.style.borderRadius = '50%';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animation = `twinkle ${Math.random() * 3 + 2}s infinite`;
                entryOverlay.appendChild(star);
            }
            
            // Handle entry
            const enterBtn = document.getElementById('enterBtn');
            const mainContainer = document.getElementById('mainContainer');
            const bgMusic = document.getElementById('bgMusic');
            
            enterBtn.addEventListener('click', () => {
                entryOverlay.classList.add('hidden');
                mainContainer.classList.add('visible');
                
                bgMusic.play().then(() => {
                    setupAudioVisualizer();
                    document.getElementById('playPauseBtn').textContent = 'Pause';
                }).catch(console.log);
                
                localStorage.setItem('visited', 'true');
            });
            
            // Skip entry if already visited
            if (localStorage.getItem('visited')) {
                entryOverlay.classList.add('hidden');
                mainContainer.classList.add('visible');
            }
            
            // Audio controls
            const playPauseBtn = document.getElementById('playPauseBtn');
            const muteBtn = document.getElementById('muteBtn');
            const volumeSlider = document.getElementById('volumeSlider');
            
            playPauseBtn.addEventListener('click', () => {
                if (bgMusic.paused) {
                    bgMusic.play();
                    playPauseBtn.textContent = 'Pause';
                    if (!analyser) setupAudioVisualizer();
                } else {
                    bgMusic.pause();
                    playPauseBtn.textContent = 'Play';
                }
            });
            
            muteBtn.addEventListener('click', () => {
                bgMusic.muted = !bgMusic.muted;
                muteBtn.textContent = bgMusic.muted ? 'Unmute' : 'Mute';
            });
            
            volumeSlider.addEventListener('input', (e) => {
                bgMusic.volume = e.target.value / 100;
            });
            
            // Mouse tracking
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX / window.innerWidth;
                mouseY = e.clientY / window.innerHeight;
            });
            
            // Gyroscope for mobile
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', (e) => {
                    if (e.gamma !== null && e.beta !== null) {
                        mouseX = (e.gamma + 90) / 180;
                        mouseY = (e.beta + 90) / 180;
                    }
                });
            }
            
            // Scroll finale
            let finaleTriggered = false;
            window.addEventListener('scroll', () => {
                const scrollPosition = window.innerHeight + window.scrollY;
                const documentHeight = document.body.offsetHeight;
                
                if (scrollPosition >= documentHeight - 100 && !finaleTriggered) {
                    finaleTriggered = true;
                    const nameFinale = document.getElementById('nameFinale');
                    nameFinale.classList.add('show-finale');
                    
                    // Create particle explosion
                    for (let i = 0; i < 50; i++) {
                        setTimeout(() => {
                            const particle = document.createElement('div');
                            particle.style.position = 'fixed';
                            particle.style.width = particle.style.height = Math.random() * 4 + 2 + 'px';
                            particle.style.background = 'white';
                            particle.style.borderRadius = '50%';
                            particle.style.left = '50%';
                            particle.style.top = '50%';
                            particle.style.pointerEvents = 'none';
                            particle.style.animation = `particle-explode ${Math.random() * 2 + 1}s ease-out forwards`;
                            document.body.appendChild(particle);
                            
                            setTimeout(() => particle.remove(), 3000);
                        }, i * 20);
                    }
                }
            });
            
            // Animation loop
            function animate() {
                drawStars();
                requestAnimationFrame(animate);
            }
            animate();
        });
        
        // Window resize handler
        window.addEventListener('resize', resizeCanvas);
        
        // Create particle explosion animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes particle-explode {
                0% {
                    transform: translate(-50%, -50%) scale(0);
                    opacity: 1;
                }
                100% {
                    transform: translate(
                        calc(-50% + ${Math.random() * 400 - 200}px),
                        calc(-50% + ${Math.random() * 400 - 200}px)
                    ) scale(1);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
